<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Question Details</title>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
  <link rel="stylesheet" href="/home.css">
  <link rel="stylesheet" href="/questionDetails.css">
</head>
<body>
  <header>
    <%- include('./nav') %>
  </header>

  <main class="main">
    <div class="main__content">

      <!-- Back Button -->
      <button onclick="window.location.href='/university/<%= question.University.uni_name.replace(/ /g, '-') %>'" class="btn btn-secondary">
        <i class="ri-arrow-left-line"></i> Back to University Page
      </button>

      <div class="question-details">
        <h2><%= question.question_text %></h2>
        <p>Asked on <%= question.created_at.toDateString() %></p>

		<% if (user && userType === 'student' && user.uni_id === university.uni_id) { %>
			<div class="submit-answer">
			  <form action="/answerQuestion" method="POST">
				<input type="hidden" name="question_id" value="<%= question.question_id %>">
				<div class="form-group">
				  <textarea class="form-control" name="answer_text" rows="2" placeholder="Write your answer here..." required></textarea>
				</div>
				<button type="submit" class="btn btn-success">Submit Answer</button>
			  </form>
			</div>
		<% } %>

        <h3>Answers</h3>
        <ul class="answers-list">
			<% if (answers && answers.length) { %>
			  <% answers.forEach(answer => { %>
				<li class="answer-item">
				  <div class="profile-info">
					<a href="/profile/<%= answer.Student.id %>" class="profile-link">
					  <img src="<%= answer.Student.profilePicture ? answer.Student.profilePicture : '/default_profile.png' %>" alt="<%= answer.Student.username %>'s Profile Picture" class="profile-picture">
					</a>
					<div class="profile-name">
					  <a href="/profile/<%= answer.Student.id %>" class="profile-link">
						<%= answer.Student.username %>
					  </a>
					</div>
				  </div>
				  <p><%= answer.answer_text %> (Answered on <%= answer.created_at.toDateString() %>)</p>
				</li>
			  <% }) %>
			<% } else { %>
			  <li>No answers yet.</li>
			<% } %>
		  </ul>
          <% if (answers && answers.length) { %>
            <% answers.forEach(answer => { %>
              <li class="answer-item">
                <a href="/profile/<%= answer.Student.username.replace(/ /g, '-') %>" class="profile-link">
					<img src="<%= answer.Student.profilePicture ? answer.Student.profilePicture : '/default_profile.png' %>" alt="<%= answer.Student.username %>'s Profile Picture" class="profile-picture">
                  <%= answer.Student.username %>
                </a>
                <p><%= answer.answer_text %> (Answered on <%= answer.created_at.toDateString() %>)</p>
                <div class="vote" data-id="<%= answer.answer_id %>"> 
                <button class="btn btn-success" onclick="sendVote('like', <%= answer.answer_id %> )">Like </button>
                <button class="btn btn-secondary" onclick="sendVote('dislike', <%= answer.answer_id %>)">Dislike</button>
                </div>
                <div>
                  Likes <input type="text" disabled value="">
                  Dislikes <input type="text" disabled value="">
                </div>
              </li>
            <% }) %>
          <% } else { %>
            <li>No answers yet.</li>
          <% } %>
        </ul>

        <% if (user && userType === 'student' && user.uni_id === university.uni_id) { %>
          <form action="/answerQuestion" method="POST">
            <input type="hidden" name="question_id" value="<%= question.question_id %>">
            <div class="form-group">
              <textarea class="form-control" name="answer_text" rows="2" placeholder="Write your answer here..." required></textarea>
            </div>
            <button type="submit" class="btn btn-success">Submit Answer</button>
          </form>
        <% } %>
      </div>
    </div>
  </main>

  <script src="/home.js"></script>
  <script src="/question_background.js"></script>
  <script src="/like-dislike.js"></script>
</body>
</html>
